
<div class="layui-tab-content goods-item-edit prize-item-edit ">

    <div>
        <form class="layui-form form-container" action="{:url('admin/ScorePrize/add')}" method="post" onsubmit="return RESOLVE_INIT.submitForm(this);">


              <div class="layui-form-item">
                  <label class="layui-form-label">奖品名</label>
                  <div class="layui-input-block">
                      <input type="text" name="name" value="{$data.name ? $data.name : ''}" required  lay-verify="required" placeholder="请输入商品名" class="layui-input">
                  </div>
              </div>
              <div class="layui-form-item">
                  <label class="layui-form-label">期数</label>
                  <div class="layui-input-block">
                      <input type="number"  value="{$data.publication_number ? $data.publication_number : 1 }"  placeholder="期数" class="layui-input" readonly disabled>
                  </div>
              </div>
              <div class="layui-form-item">
                  <label class="layui-form-label">描述</label>
                  <div class="layui-input-block">
                     <textarea name="desc" placeholder="请输入描述" class="layui-textarea">{$data.desc ? $data.desc :''}</textarea>
                  </div>
              </div>
              <div class="layui-form-item">
                  <label class="layui-form-label">缩略图</label>
                  <div class="layui-input-block">
                    <input type="text" name="thumb" value="{$data.thumb ? $data.thumb  : ''}" class="layui-input">
                    <a   class="amain-uploadImgBtn" id="upload-btn">
                       <img class="layui-upload-img" id="item-thumb" src="{$data.thumb ? $data.thumb  : ''}" >
                       <div class="text">
                         <i class="fa fa-upload"></i>上传图片
                       </div>
                    </a>
                    <p id="uploadText"></p>

                  </div>
              </div>
               <div class="layui-form-item">
                  <label class="layui-form-label">采购价</label>
                  <div class="layui-input-block">
                      <input type="text" name="amount" value="{$data.amount ? $data.amount : 0}"  required  lay-verify="required" placeholder="请输入奖品采购价" class="layui-input">
                  </div>
              </div>
              <div class="layui-form-item">
                  <label class="layui-form-label">抽奖单价</label>
                  <div class="layui-input-block">
                      <input type="text" name="price" value="{$data.price ? $data.price : 100}"  required  lay-verify="required" placeholder="抽奖所需积分" class="layui-input" >
                      <div class="layui-form-mid layui-word-aux"  >每次抽奖所消耗积分</div>
                  </div>
              </div>

              <div class="layui-form-item">
                  <label class="layui-form-label">期望总数</label>
                  <div class="layui-input-block">
                      <input type="number" name="total_count"  value="{$data.total_count ? $data.total_count : 1000}"  required  lay-verify="required" placeholder="开奖阈值" class="layui-input" >
                      <div class="layui-form-mid layui-word-aux"    >当购买票数达到该数量时开奖</div>
                  </div>
              </div>

              <div class="layui-form-item">
                  <label class="layui-form-label">级别</label>
                  <div class="layui-input-block">
                      <input type="number" name="level" min="-1" value="{$data.level ? $data.level : 3}"  required  lay-verify="required" placeholder="奖品级别" class="layui-input">
                      <div class="layui-form-mid layui-word-aux">奖品级别(第几等奖)</div>
                  </div>
              </div>

              <div class="layui-form-item">
                  <label class="layui-form-label">状态</label>
                  <div class="layui-input-block">
                    <select name="status"  >
                        <option value="-1" selected >准备开始</option>
                      <option value="0" >进行中（正常）</option>
                      <option value="1">进行中（推荐）</option>
                       <option value="2" >进行中（置顶）</option>
                     </select>
                     <div class="layui-form-mid layui-word-aux">默认为“准备开始”，抽奖一但进行，则不允许再对奖品信息进行修改，请三思而行。</div>

                  </div>
              </div>

              <div class="layui-form-item">
                  <label class="layui-form-label">自动续期</label>
                  <div class="layui-input-block">
                      <input type="checkbox" name="un_shelves" value="1" lay-skin="switch" lay-text="是|否" checked>
                      <div class="layui-form-mid layui-word-aux" >开奖后，是否自动生成并开始下一期抽奖。</div>
                  </div>
              </div>





            <div class="blank20"></div>

            <div class="layui-btn-container layui-row">
                <input type="hidden" name="identity" value="{$data.identity ? $data.identity : ''}">
                <button class="layui-btn layui-btn-lg layui-col-xs12" >提交</button>
            </div>

        </form>
    </div>
</div>
<script>

RESOLVE_INIT = {

  upload : layui.upload,
  init: function(){
    var $thumbInput = $('.goods-item-edit').find("input[name=thumb]");
    //普通图片上传
     var uploadInst = this.upload.render({
       elem: '#upload-btn'
       ,url: "{:url('admin/Uploader/images')}"
       ,data: {"module":"admin/ScorePrize"}
       ,before: function(obj){
         //预读本地文件示例，不支持ie8
         obj.preview(function(index, file, result){
           // $('#item-thumb').attr('src', result); //图片链接（base64）
         });
       }
       ,done: function(res){
         console.log(res);
         //如果上传失败
         if(res.code > 0){
           return layer.msg('上传失败');
         }
         if(res.code===0){
           layer.msg('上传成功');

           $('#item-thumb').attr('src', res.data.img_url); //图片链接（base64）
           $thumbInput.val(res.data.img_url);
         }else{
           layer.msg(res.desc);
         }
       }
       ,error: function(){
         //演示失败状态，并实现重传
         var $uploadText = $('#uploadText');
         var html = '<span style="color: #FF5722;">上传失败,请稍候再试</span>';
         // html += '<a class="layui-btn layui-btn-xs reUpload">重试</a>';
         $uploadText.html(html);
         /*$uploadText.find('.reUpload').on('click', function(){
           uploadInst.upload();
         });*/
       }
     });
     $thumbInput.keyup(function(event) {
       /* Act on the event */
       var thumbPath = $thumbInput.val();
       $('#item-thumb').attr('src', thumbPath);
     });
     form.render();
  },

  submitForm(form){
    var $form = $(form);

    ajaxSubmit({
      data: $form.serialize(),
      url:$form.attr('action'),
      // unrefresh:true,
      success:function(res){
      }

    })
    return false;
  }
}


RESOLVE_INIT.init();


</script>
